# ุงุฎุชุจุงุฑ ุณูุฑ ุนูู ุฑุญูุงุช ุงูุชูุฒูุน - MarketZone

## ๐งช ุณููุงุฑูู ุงูุงุฎุชุจุงุฑ ุงูุดุงูู

### **ุงูุจูุงูุงุช ุงููุทููุจุฉ ููุงุฎุชุจุงุฑ:**

#### **1. ุงูููุธููู (Employees)**
```json
POST /api/Employee/CreateEmployee
{
  "name": "ุฃุญูุฏ ูุญูุฏ",
  "phone": "0123456789",
  "email": "ahmed@marketzone.com",
  "address": "ุงููุงูุฑุฉ"
}
```

#### **2. ุงูุณูุงุฑุงุช (Cars)**
```json
POST /api/Car/CreateCar
{
  "name": "ุณูุงุฑุฉ ุชูุฒูุน 1",
  "plateNumber": "ุฃ ุจ ุฌ 123",
  "model": "2023",
  "year": 2023,
  "capacityKg": 1000,
  "isAvailable": true
}
```

#### **3. ุงูููุงุทู (Regions)**
```json
POST /api/Region/CreateRegion
{
  "name": "ุงูููุทูุฉ ุงูุดูุงููุฉ",
  "description": "ุชุบุทู ุดูุงู ุงููุงูุฑุฉ",
  "isActive": true
}
```

#### **4. ุงูุนููุงุก (Customers)**
```json
POST /api/Customer/CreateCustomer
{
  "name": "ูุญู ุงูุจู ุงูุทุงุฒุฌ",
  "phone": "0987654321",
  "email": "customer1@example.com",
  "address": "ุดุงุฑุน ุงููููุ ุงููุงูุฑุฉ",
  "whatsAppPhone": "0987654321"
}
```

#### **5. ุงูููุชุฌุงุช (Products)**
```json
POST /api/Product/CreateProduct
{
  "name": "ุจู ุฃุฑุงุจููุง",
  "description": "ุจู ุฃุฑุงุจููุง ุนุงูู ุงูุฌูุฏุฉ",
  "categoryId": 1,
  "unitOfMeasure": "ูููู",
  "barCode": "123456789",
  "barCode2": "987654321"
}
```

#### **6. ุฑุตูุฏ ุงูููุชุฌุงุช (ProductBalance)**
```json
POST /api/ProductBalance/CreateProductBalance
{
  "productId": 1,
  "qty": 200,
  "availableQty": 200
}
```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู ููุงุฎุชุจุงุฑ

### **ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุฑุญูุฉ ุชูุฒูุน ุฌุฏูุฏุฉ**

```bash
POST /api/DistributionTrip/CreateDistributionTrip
```

```json
{
  "employeeId": 1,
  "carId": 1,
  "regionId": 1,
  "tripDate": "2025-01-15",
  "loadQty": 500,
  "notes": "ุฑุญูุฉ ุชูุฒูุน ููููุทูุฉ ุงูุดูุงููุฉ - ุงุฎุชุจุงุฑ ุดุงูู",
  "details": [
    {
      "productId": 1,
      "qty": 100,
      "expectedPrice": 25.50
    }
  ]
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุฑุญูุฉ ุชูุฒูุน ุฌุฏูุฏุฉ ุจุฑูู ID
- ุญุงูุฉ ุงูุฑุญูุฉ: `Draft` (ูุณูุฏุฉ)
- `SoldQty` = 0 ูุฌููุน ุงูููุชุฌุงุช
- `ReturnedQty` = 0 ูุฌููุน ุงูููุชุฌุงุช
- **AvailableQty ูู ProductBalance ููุตุช ุจููุฏุงุฑ 100**

**ุงูุชุญูู ูู ุงูุฃุฎุทุงุก:**
- ุฅุฐุง ูุงู `employeeId` ุบูุฑ ููุฌูุฏ: ุฎุทุฃ 404
- ุฅุฐุง ูุงู `carId` ุบูุฑ ููุฌูุฏ: ุฎุทุฃ 404
- ุฅุฐุง ูุงู `regionId` ุบูุฑ ููุฌูุฏ: ุฎุทุฃ 404
- ุฅุฐุง ูุงู `productId` ุบูุฑ ููุฌูุฏ: ุฎุทุฃ 404
- ุฅุฐุง ูุงูุช `AvailableQty` ุบูุฑ ูุงููุฉ: ุฎุทุฃ "Insufficient available quantity"

---

### **ุงูุฎุทูุฉ 2: ุชุฑุญูู ุงูุฑุญูุฉ**

```bash
PUT /api/DistributionTrip/PostDistributionTrip
```

```json
{
  "id": 1
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุญุงูุฉ ุงูุฑุญูุฉ: `Posted` (ูุฑุญูุฉ)
- ุงูุฑุญูุฉ ุฌุงูุฒุฉ ููุชูููุฐ
- **Qty ูู ProductBalance ููุตุช ุจููุฏุงุฑ 100**

**ุงูุชุญูู ูู ุงูุฃุฎุทุงุก:**
- ุฅุฐุง ูุงูุช ุงูุฑุญูุฉ ููุณุช ูู ุญุงูุฉ `Draft`: ุฎุทุฃ "Cannot post trip that is not in Draft status"
- ุฅุฐุง ูุงูุช `Qty` ุบูุฑ ูุงููุฉ: ุฎุทุฃ "Insufficient quantity"

---

### **ุงูุฎุทูุฉ 3: ุงุณุชูุงู ุงูุจุถุงุนุฉ (ุชุณุฌูู ุงููุฑุชุฌุนุงุช)**

```bash
PUT /api/DistributionTrip/ReceiveGoods
```

```json
{
  "tripId": 1,
  "details": [
    {
      "detailId": 1,
      "returnedQty": 15
    }
  ]
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุญุงูุฉ ุงูุฑุญูุฉ: `GoodsReceived` (ุชู ุงุณุชูุงู ุงูุจุถุงุนุฉ)
- `ReturnedQty` = 15 ููููุชุฌ
- `SoldQty` = 0 (ูู ูุชู ุฅูุดุงุก ููุงุชูุฑ ุจุนุฏ)

**ุงูุชุญูู ูู ุงูุฃุฎุทุงุก:**
- ุฅุฐุง ูุงูุช ุงูุฑุญูุฉ ููุณุช ูู ุญุงูุฉ `Posted`: ุฎุทุฃ "Cannot receive goods for trip that is not in Posted status"
- ุฅุฐุง ูุงูุช `returnedQty` > `qty`: ุฎุทุฃ "Returned quantity cannot exceed loaded quantity"

---

### **ุงูุฎุทูุฉ 4: ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช ููุฒุน (ุงูุนููู ุงูุฃูู)**

```bash
POST /api/SalesInvoice/CreateSalesInvoice
```

```json
{
  "invoiceNumber": "INV-DIST-001",
  "customerId": 1,
  "invoiceDate": "2025-01-15",
  "totalAmount": 765.00,
  "discount": 0,
  "paymentMethod": "ููุฏู",
  "notes": "ูุงุชูุฑุฉ ุชูุฒูุน - ุงูุนููู ุงูุฃูู",
  "type": "Distributor",
  "distributionTripId": 1,
  "details": [
    {
      "productId": 1,
      "quantity": 30,
      "unitPrice": 25.50,
      "subTotal": 765.00,
      "notes": "ุทูุจ ุนุงุฏู"
    }
  ]
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ูุงุชูุฑุฉ ูุจูุนุงุช ุฌุฏูุฏุฉ ุจุฑูู ID
- `SoldQty` ููููุชุฌ ูู ุฑุญูุฉ ุงูุชูุฒูุน = 30
- ุงููุงุชูุฑุฉ ูุฑุชุจุทุฉ ุจุฑุญูุฉ ุงูุชูุฒูุน

**ุงูุชุญูู ูู ุงูุฃุฎุทุงุก:**
- ุฅุฐุง ูุงูุช ุฑุญูุฉ ุงูุชูุฒูุน ููุณุช ูู ุญุงูุฉ `GoodsReceived`: ุฎุทุฃ "Cannot create distributor invoice for trip that is not in GoodsReceived status"
- ุฅุฐุง ูุงูุช ุงููููุฉ ุงููุจุงุนุฉ ุชุชุฌุงูุฒ ุงููููุฉ ุงููุญููุฉ: ุฎุทุฃ "Sold quantity cannot exceed loaded quantity"

---

### **ุงูุฎุทูุฉ 5: ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช ููุฒุน (ุงูุนููู ุงูุซุงูู)**

```bash
POST /api/SalesInvoice/CreateSalesInvoice
```

```json
{
  "invoiceNumber": "INV-DIST-002",
  "customerId": 1,
  "invoiceDate": "2025-01-15",
  "totalAmount": 637.50,
  "discount": 0,
  "paymentMethod": "ุดูู",
  "notes": "ูุงุชูุฑุฉ ุชูุฒูุน - ุงูุนููู ุงูุซุงูู",
  "type": "Distributor",
  "distributionTripId": 1,
  "details": [
    {
      "productId": 1,
      "quantity": 25,
      "unitPrice": 25.50,
      "subTotal": 637.50,
      "notes": "ุทูุจ ุนุงุฌู"
    }
  ]
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ูุงุชูุฑุฉ ูุจูุนุงุช ุฌุฏูุฏุฉ ุจุฑูู ID
- `SoldQty` ููููุชุฌ ูู ุฑุญูุฉ ุงูุชูุฒูุน = 55 (30 + 25)
- ุงููุงุชูุฑุฉ ูุฑุชุจุทุฉ ุจุฑุญูุฉ ุงูุชูุฒูุน

---

### **ุงูุฎุทูุฉ 6: ุงูุชุญูู ูู ุงููููุงุช**

```bash
GET /api/DistributionTrip/ValidateTripQuantities?TripId=1
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "isValid": true,
  "errors": [],
  "warnings": []
}
```

---

### **ุงูุฎุทูุฉ 7: ุฅููุงู ุงูุฑุญูุฉ**

```bash
PUT /api/DistributionTrip/CompleteTrip
```

```json
{
  "tripId": 1
}
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- ุญุงูุฉ ุงูุฑุญูุฉ: `Completed` (ููุชููุฉ)
- ุงูุฑุญูุฉ ููุชููุฉ ุจูุฌุงุญ

**ุงูุชุญูู ูู ุงูุฃุฎุทุงุก:**
- ุฅุฐุง ูุงูุช ุงูุฑุญูุฉ ููุณุช ูู ุญุงูุฉ `GoodsReceived`: ุฎุทุฃ "Cannot complete trip that is not in GoodsReceived status"
- ุฅุฐุง ูุงูุช ููุงู ุชูุงุตูู ุจุฏูู ูุจูุนุงุช ุฃู ูุฑุชุฌุนุงุช: ุฎุทุฃ "All trip details must have either sold quantity or returned quantity"
- ุฅุฐุง ูุงูุช ุงููููุงุช ุงููุจุงุนุฉ ูุงููุฑุฌุนุฉ ุชุชุฌุงูุฒ ุงููููุฉ ุงููุญููุฉ: ุฎุทุฃ "Invalid quantities"

---

## ๐ ุงูุชุญูู ูู ุงููุชุงุฆุฌ

### **ุงูุชุญูู ูู ุฑุญูุฉ ุงูุชูุฒูุน:**

```bash
GET /api/DistributionTrip/GetPagedListDistributionTrip?PageNumber=1&PageSize=10
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "data": [
    {
      "id": 1,
      "employeeId": 1,
      "carId": 1,
      "regionId": 1,
      "tripDate": "2025-01-15T00:00:00",
      "loadQty": 500,
      "notes": "ุฑุญูุฉ ุชูุฒูุน ููููุทูุฉ ุงูุดูุงููุฉ - ุงุฎุชุจุงุฑ ุดุงูู",
      "status": "Completed",
      "details": [
        {
          "id": 1,
          "productId": 1,
          "qty": 100,
          "expectedPrice": 25.50,
          "returnedQty": 15,
          "soldQty": 55
        }
      ]
    }
  ]
}
```

### **ุงูุชุญูู ูู ููุงุชูุฑ ุงููุจูุนุงุช:**

```bash
GET /api/SalesInvoice/GetPagedListSalesInvoice?PageNumber=1&PageSize=10
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "data": [
    {
      "id": 1,
      "invoiceNumber": "INV-DIST-001",
      "customerId": 1,
      "type": "Distributor",
      "distributionTripId": 1,
      "totalAmount": 765.00,
      "status": "Draft"
    },
    {
      "id": 2,
      "invoiceNumber": "INV-DIST-002",
      "customerId": 1,
      "type": "Distributor",
      "distributionTripId": 1,
      "totalAmount": 637.50,
      "status": "Draft"
    }
  ]
}
```

### **ุงูุชุญูู ูู ProductBalance:**

```bash
GET /api/ProductBalance/GetByProductId/1
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```json
{
  "id": 1,
  "productId": 1,
  "qty": 100,        // 200 - 100 (ูู Post)
  "availableQty": 100 // 200 - 100 (ูู Create)
}
```

---

## โ ูุนุงููุฑ ุงููุฌุงุญ

### **1. ุณูุฑ ุงูุนูู:**
- โ ุฅูุดุงุก ุฑุญูุฉ ุชูุฒูุน ุจูุฌุงุญ ูุน ุงูุชุญูู ูู ุงูู IDs
- โ ุงูุชุญูู ูู ุงููููุงุช ุงููุชุงุญุฉ ูู ProductBalance
- โ ููุต AvailableQty ุนูุฏ ุฅูุดุงุก ุงูุฑุญูุฉ
- โ ููุต Qty ุนูุฏ Post ุงูุฑุญูุฉ
- โ ุงุณุชูุงู ุงูุจุถุงุนุฉ ุจูุฌุงุญ
- โ ุฅูุดุงุก ููุงุชูุฑ ุงููุจูุนุงุช ุจูุฌุงุญ
- โ ุชุญุฏูุซ `SoldQty` ุชููุงุฆูุงู
- โ ุงูุชุญูู ูู ุงููููุงุช ุจูุฌุงุญ
- โ ุฅููุงู ุงูุฑุญูุฉ ุจูุฌุงุญ

### **2. ุงูุชุญูู ูู ุงูุฃุฎุทุงุก:**
- โ ุงูุชุญูู ูู ูุฌูุฏ Employee, Car, Region, Product
- โ ุงูุชุญูู ูู ุงููููุงุช ุงููุชุงุญุฉ
- โ ุงูุชุญูู ูู ุญุงูุฉ ุงูุฑุญูุฉ ูู ูู ุฎุทูุฉ
- โ ุงูุชุญูู ูู ุงููููุงุช ุงููุจุงุนุฉ ูุงููุฑุฌุนุฉ
- โ ุงูุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช ูู ุญุงูุฉ ุงูุฎุทุฃ

### **3. ุงูุจูุงูุงุช:**
- โ `SoldQty` ุชูุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ููุงุชูุฑ ุงููุจูุนุงุช
- โ `ReturnedQty` ุชูุฎุฒู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูุนูุงูุงุช ุจูู ุงูููุงูุงุช ุชุนูู ุจุดูู ุตุญูุญ
- โ ุงูุชุญูู ูู ุงููููุงุช ูุนูู ุจุดูู ุตุญูุญ
- โ ProductBalance ูุชู ุชุญุฏูุซู ุจุดูู ุตุญูุญ

---

## ๐จ ุงุฎุชุจุงุฑ ุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ

### **1. ูุญุงููุฉ ุฅูุดุงุก ุฑุญูุฉ ุชูุฒูุน ุจููุธู ุบูุฑ ููุฌูุฏ:**
```json
{
  "employeeId": 999,
  "carId": 1,
  "regionId": 1,
  "tripDate": "2025-01-15",
  "loadQty": 500,
  "notes": "ุงุฎุชุจุงุฑ ุฎุทุฃ",
  "details": [
    {
      "productId": 1,
      "qty": 100,
      "expectedPrice": 25.50
    }
  ]
}
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุฎุทุฃ 404 - Employee not found

### **2. ูุญุงููุฉ ุฅูุดุงุก ุฑุญูุฉ ุชูุฒูุน ุจูููุฉ ุบูุฑ ูุชุงุญุฉ:**
```json
{
  "employeeId": 1,
  "carId": 1,
  "regionId": 1,
  "tripDate": "2025-01-15",
  "loadQty": 500,
  "notes": "ุงุฎุชุจุงุฑ ุฎุทุฃ",
  "details": [
    {
      "productId": 1,
      "qty": 1000,
      "expectedPrice": 25.50
    }
  ]
}
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุฎุทุฃ - Insufficient available quantity

### **3. ูุญุงููุฉ Post ุฑุญูุฉ ููุณุช ูู ุญุงูุฉ Draft:**
```json
{
  "id": 1
}
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุฎุทุฃ - Cannot post trip that is not in Draft status

### **4. ูุญุงููุฉ ุงุณุชูุงู ุงูุจุถุงุนุฉ ูุฑุญูุฉ ูู ุญุงูุฉ Draft:**
```json
{
  "tripId": 1,
  "details": [
    {
      "detailId": 1,
      "returnedQty": 15
    }
  ]
}
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุฎุทุฃ - Cannot receive goods for trip that is not in Posted status

### **5. ูุญุงููุฉ ุฅูุดุงุก ูุงุชูุฑุฉ ููุฒุน ูุฑุญูุฉ ูู ุญุงูุฉ Posted:**
```json
{
  "type": "Distributor",
  "distributionTripId": 1
}
```
**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุฎุทุฃ - Cannot create distributor invoice for trip that is not in GoodsReceived status

---

## ๐ ููุงุญุธุงุช ุงูุงุฎุชุจุงุฑ

1. **ุชุฃูุฏ ูู ูุฌูุฏ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ** ูุจู ุจุฏุก ุงูุงุฎุชุจุงุฑ
2. **ุชุฃูุฏ ูู ูุฌูุฏ ProductBalance** ูุน ูููุงุช ูุงููุฉ
3. **ุงุญูุธ ุงูู IDs** ุงููุณุชุฎุฏูุฉ ูู ุงูุงุฎุชุจุงุฑ ููุชุญูู ูููุง
4. **ุงุฎุชุจุฑ ุจุงูุชุฑุชูุจ** ุงููุญุฏุฏ
5. **ุชุญูู ูู ุงููุชุงุฆุฌ** ุจุนุฏ ูู ุฎุทูุฉ
6. **ุงุฎุชุจุฑ ุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ** ููุชุฃูุฏ ูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
7. **ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช** ูุจุงุดุฑุฉ ููุชุฃูุฏ ูู ุตุญุฉ ุงูุจูุงูุงุช
8. **ุงุฎุชุจุฑ ุงูุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช** ูู ุญุงูุฉ ุงูุฎุทุฃ

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุจุนุฏ ุฅููุงู ุฌููุน ุงูุฎุทูุงุชุ ูุฌุจ ุฃู ูููู ูุฏูู:
- ุฑุญูุฉ ุชูุฒูุน ููุชููุฉ
- ููุงุชูุฑ ูุจูุนุงุช ููุฒุน ูุฑุชุจุทุฉ ุจุงูุฑุญูุฉ
- ูููุงุช ูุจุงุนุฉ ูุญุฏุซุฉ ุชููุงุฆูุงู
- ูููุงุช ูุฑุฌุนุฉ ูุฎุฒูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ProductBalance ูุญุฏุซ ุจุดูู ุตุญูุญ
- ูุธุงู ูุนูู ุจุดูู ูุชูุงูู ููุชูุงุณู ูุน ุงูุชุญูู ูู ุงูุฃุฎุทุงุก
- ุงูุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช ูู ุญุงูุฉ ุงูุฎุทุฃ
