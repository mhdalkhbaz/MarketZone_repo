# ุชูุฑูุฑ ุดุงูู: ุฏุฑุงุณุฉ ุฑุญูุฉ ุงูุชูุฒูุน ูู ูุธุงู MarketZone

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุฑุญูุฉ ุงูุชูุฒูุน ูู ูุธุงู ูุชูุงูู ูุฅุฏุงุฑุฉ ุนูููุฉ ุชูุฒูุน ุงูููุชุฌุงุช ูู ุงููุณุชูุฏุน ุฅูู ุงูุนููุงุก ุนุจุฑ ุงูููุฒุนูู. ูุชุถูู ุงููุธุงู ุฅุฏุงุฑุฉ ุดุงููุฉ ูุฌููุน ูุฑุงุญู ุงูุนูููุฉ ูู ุงูุฅูุดุงุก ุญุชู ุงูุฅููุงู.

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ

### 1. ุทุจูุฉ ุงููุทุงู (Domain Layer)

#### ุงูููุงูุงุช ุงูุฃุณุงุณูุฉ:

**DistributionTrip (ุฑุญูุฉ ุงูุชูุฒูุน)**
```csharp
public class DistributionTrip : AuditableBaseEntity
{
    public long EmployeeId { get; private set; }      // ุงูููุธู ุงููุณุคูู
    public long CarId { get; private set; }           // ุงูุณูุงุฑุฉ ุงููุณุชุฎุฏูุฉ
    public long RegionId { get; private set; }        // ุงูููุทูุฉ ุงููุณุชูุฏูุฉ
    public DateTime TripDate { get; private set; }    // ุชุงุฑูุฎ ุงูุฑุญูุฉ
    public decimal? LoadQty { get; private set; }     // ุฅุฌูุงูู ุงููููุฉ ุงููุญููุฉ
    public string Notes { get; private set; }         // ููุงุญุธุงุช
    public DistributionTripStatus Status { get; private set; } // ุญุงูุฉ ุงูุฑุญูุฉ
    
    public List<DistributionTripDetail> Details { get; private set; }
    public List<SalesInvoice> DistributionTripSalesInvoices { get; private set; }
}
```

**DistributionTripDetail (ุชูุงุตูู ุฑุญูุฉ ุงูุชูุฒูุน)**
```csharp
public class DistributionTripDetail : AuditableBaseEntity
{
    public long TripId { get; private set; }          // ุฑุจุท ุจุฑุญูุฉ ุงูุชูุฒูุน
    public long ProductId { get; private set; }       // ุงูููุชุฌ
    public decimal Qty { get; private set; }          // ุงููููุฉ ุงููุญููุฉ
    public decimal ExpectedPrice { get; private set; } // ุงูุณุนุฑ ุงููุชููุน
    public decimal ReturnedQty { get; private set; }   // ุงููููุฉ ุงููุฑุฌุนุฉ
    public decimal SoldQty { get; private set; }       // ุงููููุฉ ุงููุจุงุนุฉ
}
```

#### ุญุงูุงุช ุฑุญูุฉ ุงูุชูุฒูุน:
```csharp
public enum DistributionTripStatus : short
{
    Draft = 0,              // ูุณูุฏุฉ
    Posted = 1,             // ูุฑุญูุฉ (ุชู ุงูุชุฑุญูู)
    InProgress = 2,         // ููุฏ ุงูุชูููุฐ
    GoodsReceived = 3,      // ุชู ุงุณุชูุงู ุงูุจุถุงุนุฉ
    Completed = 4,          // ููุชููุฉ
    Cancelled = 5           // ููุบูุฉ
}
```

### 2. ุทุจูุฉ ุงูุชุทุจูู (Application Layer)

#### ุงูุฃูุงูุฑ (Commands):

1. **CreateDistributionTripCommand** - ุฅูุดุงุก ุฑุญูุฉ ุชูุฒูุน ุฌุฏูุฏุฉ
2. **UpdateDistributionTripCommand** - ุชุญุฏูุซ ุฑุญูุฉ ุงูุชูุฒูุน
3. **PostDistributionTripCommand** - ุชุฑุญูู ุงูุฑุญูุฉ
4. **ReceiveGoodsCommand** - ุงุณุชูุงู ุงูุจุถุงุนุฉ
5. **CompleteTripCommand** - ุฅููุงู ุงูุฑุญูุฉ

#### ุงูุงุณุชุนูุงูุงุช (Queries):

1. **GetPagedListDistributionTripQuery** - ุงูุญุตูู ุนูู ูุงุฆูุฉ ุงูุฑุญูุงุช
2. **ValidateTripQuantitiesQuery** - ุงูุชุญูู ูู ุตุญุฉ ุงููููุงุช

### 3. ุทุจูุฉ ุงูุจููุฉ ุงูุชุญุชูุฉ (Infrastructure Layer)

#### ุงูุชูููู (Configuration):
- **DistributionTripConfiguration** - ุชูููู ููุงู ุฑุญูุฉ ุงูุชูุฒูุน
- **DistributionTripDetailConfiguration** - ุชูููู ุชูุงุตูู ุงูุฑุญูุฉ

#### ุงููุณุชูุฏุนุงุช (Repositories):
- **IDistributionTripRepository** - ูุงุฌูุฉ ูุณุชูุฏุน ุฑุญูุฉ ุงูุชูุฒูุน
- **DistributionTripRepository** - ุชูููุฐ ูุณุชูุฏุน ุฑุญูุฉ ุงูุชูุฒูุน

## ๐ ุฏูุฑุฉ ุญูุงุฉ ุฑุญูุฉ ุงูุชูุฒูุน

### ุงููุฑุญูุฉ ุงูุฃููู: ุฅูุดุงุก ุฑุญูุฉ ุงูุชูุฒูุน
```
1. ุงูุชุญูู ูู ูุฌูุฏ ุงูููุธูุ ุงูุณูุงุฑุฉุ ุงูููุทูุฉ
2. ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุฌุงุช ูุงููููุงุช ุงููุชุงุญุฉ
3. ุฅูุดุงุก ุฑุญูุฉ ุงูุชูุฒูุน ุจุญุงูุฉ "Draft"
4. ุฅุถุงูุฉ ุชูุงุตูู ุงูููุชุฌุงุช
5. ููุต ุงููููุงุช ุงููุชุงุญุฉ ูู ProductBalance
```

**API:** `POST /api/DistributionTrip/CreateDistributionTrip`

### ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุชุฑุญูู ุงูุฑุญูุฉ
```
1. ุงูุชุญูู ูู ุฃู ุงูุฑุญูุฉ ูู ุญุงูุฉ "Draft"
2. ุชุบููุฑ ุญุงูุฉ ุงูุฑุญูุฉ ุฅูู "Posted"
3. ุฅุนุฏุงุฏ ุงูุฑุญูุฉ ููุชูููุฐ
```

**API:** `PUT /api/DistributionTrip/PostDistributionTrip`

### ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุงุณุชูุงู ุงูุจุถุงุนุฉ
```
1. ุงูุชุญูู ูู ุฃู ุงูุฑุญูุฉ ูู ุญุงูุฉ "Posted"
2. ุชุณุฌูู ุงููููุงุช ุงููุฑุฌุนุฉ ููู ููุชุฌ
3. ุชุบููุฑ ุญุงูุฉ ุงูุฑุญูุฉ ุฅูู "GoodsReceived"
```

**API:** `PUT /api/DistributionTrip/ReceiveGoods`

### ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุฅูุดุงุก ููุงุชูุฑ ุงููุจูุนุงุช
```
1. ุฅูุดุงุก ููุงุชูุฑ ูุจูุนุงุช ูู ููุน "Distributor"
2. ุฑุจุท ุงูููุงุชูุฑ ุจุฑุญูุฉ ุงูุชูุฒูุน
3. ุชุญุฏูุซ ุงููููุงุช ุงููุจุงุนุฉ ุชููุงุฆูุงู
```

**API:** `POST /api/SalesInvoice/CreateSalesInvoice` (ูุน `Type: Distributor`)

### ุงููุฑุญูุฉ ุงูุฎุงูุณุฉ: ุงูุชุญูู ูู ุงููููุงุช
```
1. ุงูุชุญูู ูู ุตุญุฉ ุงููููุงุช ุงููุณุฌูุฉ
2. ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ููุต ุฃู ุฒูุงุฏุฉ
3. ุนุฑุถ ุงูุชุญุฐูุฑุงุช ูุงูุฃุฎุทุงุก ุฅู ูุฌุฏุช
```

**API:** `GET /api/DistributionTrip/ValidateTripQuantities`

### ุงููุฑุญูุฉ ุงูุณุงุฏุณุฉ: ุฅููุงู ุงูุฑุญูุฉ
```
1. ุงูุชุญูู ูู ุงูุชูุงู ุฌููุน ุงูุนูููุงุช
2. ุฅุฑุฌุงุน ุงููุฑุชุฌุน ุฅูู AvailableQty
3. ุฅููุงุต ุงููุจุงุน ูู Qty
4. ุชุบููุฑ ุญุงูุฉ ุงูุฑุญูุฉ ุฅูู "Completed"
```

**API:** `PUT /api/DistributionTrip/CompleteTrip`

## ๐ ุฅุฏุงุฑุฉ ุงููุฎุฒูู

### ููุงุนุฏ ุชุญุฏูุซ ุงููุฎุฒูู:

1. **ุนูุฏ ุฅูุดุงุก ุงูุฑุญูุฉ:**
   - ููุต `AvailableQty` ูู ProductBalance

2. **ุนูุฏ ุชุฑุญูู ุงูุฑุญูุฉ:**
   - ูุง ุชุฃุซูุฑ ุนูู ุงููุฎุฒูู

3. **ุนูุฏ ุฅููุงู ุงูุฑุญูุฉ:**
   - ุฅุฑุฌุงุน `ReturnedQty` ุฅูู `AvailableQty`
   - ุฅููุงุต `SoldQty` ูู `Qty`

### ูุซุงู ุนูู ุงูุชุญุฏูุซ:
```
ุงููููุฉ ุงูุฃูููุฉ: Qty=200, AvailableQty=200
ุนูุฏ ุฅูุดุงุก ุงูุฑุญูุฉ (100 ูููู): Qty=200, AvailableQty=100
ุนูุฏ ุฅููุงู ุงูุฑุญูุฉ (ูุจุงุน=80, ูุฑุชุฌุน=20): Qty=120, AvailableQty=120
```

## ๐ ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

### 1. ูุธุงู ุงููุจูุนุงุช
- ุฅูุดุงุก ููุงุชูุฑ ูุจูุนุงุช ูู ููุน "ูุจูุน ููุฒุน"
- ุฑุจุท ุงูููุงุชูุฑ ุจุฑุญูุงุช ุงูุชูุฒูุน
- ุชุญุฏูุซ ุงููููุงุช ุงููุจุงุนุฉ ุชููุงุฆูุงู

### 2. ูุธุงู ุงููุฎุฒูู
- ุชุชุจุน ุงููููุงุช ุงููุชุงุญุฉ ูุงูููุฌูุฏุฉ
- ุงูุชุญูู ูู ุงููููุงุช ูุจู ุงูุชุญููู
- ุชุญุฏูุซ ุงููุฎุฒูู ุนูุฏ ุฅููุงู ุงูุฑุญูุฉ

### 3. ูุธุงู ุงููุญุงุณุจุฉ
- ุชุชุจุน ุฅูุฑุงุฏุงุช ุงูุชูุฒูุน
- ุญุณุงุจ ุชูุงููู ุงูููู
- ุชูููุฒ ููุงุชูุฑ ุงูููุฒุนูู

## ๐ก๏ธ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช

### ุงูุฃุฎุทุงุก (Errors):
- ุงููููุฉ ุงููุจุงุนุฉ + ุงููููุฉ ุงููุฑุฌุนุฉ > ุงููููุฉ ุงููุญููุฉ
- ุนุฏู ุชุณุฌูู ุฃู ูููุงุช
- ุงููููุงุช ุบูุฑ ูุชุงุญุฉ ูู ุงููุฎุฒูู

### ุงูุชุญุฐูุฑุงุช (Warnings):
- ุงููููุฉ ุงููุฑุฌุนุฉ > 30% ูู ุงููููุฉ ุงููุญููุฉ
- ุนุฏู ุชุณุฌูู ุฃู ูุจูุนุงุช ุฃู ูุฑุชุฌุนุงุช
- ุชู ุฅูุดุงุก ููุงุชูุฑ ูููู ูู ูุชู ุจูุน ุงูููุชุฌ

## ๐ ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ

### 1. ุชูุฑูุฑ ุฑุญูุงุช ุงูุชูุฒูุน
- ุฑุญูุงุช/ููุธู
- ุฑุญูุงุช/ุณูุงุฑุฉ
- ุฑุญูุงุช/ููุทูุฉ

### 2. ุชูุฑูุฑ ุฃุฏุงุก ุงูููุฒุนูู
- ูููุงุช ูุจุงุนุฉ/ููุฒุน
- ูููุงุช ูุฑุฌุนุฉ/ููุฒุน
- ูุณุจุฉ ุงููุจูุนุงุช

### 3. ุชูุฑูุฑ ุชุญููู ุงููููุงุช
- ููุงุฑูุฉ ุงููููุงุช ุงููุญููุฉ ูุงููุจุงุนุฉ
- ุชุญููู ุงููุฑุชุฌุนุงุช
- ุชุญุฏูุฏ ุงูููุชุฌุงุช ุงูุฃูุซุฑ ุทูุจุงู

### 4. ุชูุฑูุฑ ููุงุชูุฑ ุงูููุฒุนูู
- ููุงุชูุฑ/ุฑุญูุฉ ุชูุฒูุน
- ุฅูุฑุงุฏุงุช/ููุฒุน
- ุชุญููู ุงููุจูุนุงุช ุญุณุจ ุงูููุน

## ๐ง API Endpoints

### ุฅุฏุงุฑุฉ ุงูุฑุญูุงุช
```
GET    /api/DistributionTrip/GetPagedListDistributionTrip
POST   /api/DistributionTrip/CreateDistributionTrip
PUT    /api/DistributionTrip/UpdateDistributionTrip
```

### ุณูุฑ ุงูุนูู
```
PUT    /api/DistributionTrip/PostDistributionTrip
PUT    /api/DistributionTrip/ReceiveGoods
PUT    /api/DistributionTrip/CompleteTrip
```

### ุงูุชุญูู ูุงูุชุญููู
```
GET    /api/DistributionTrip/ValidateTripQuantities
```

### ููุงุชูุฑ ุงููุจูุนุงุช
```
POST   /api/SalesInvoice/CreateSalesInvoice (ูุน Type: Distributor)
GET    /api/SalesInvoice/GetPagedListSalesInvoice
PUT    /api/SalesInvoice/UpdateSalesInvoice
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูู ุงูุงุฎุชุจุงุฑ ุงูุดุงูู:
1. ุฅูุดุงุก ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ููุธูุ ุณูุงุฑุฉุ ููุทูุฉุ ุนูููุ ููุชุฌุ ุฑุตูุฏ)
2. ุฅูุดุงุก ุฑุญูุฉ ุชูุฒูุน ุฌุฏูุฏุฉ
3. ุชุฑุญูู ุงูุฑุญูุฉ
4. ุงุณุชูุงู ุงูุจุถุงุนุฉ (ุชุณุฌูู ุงููุฑุชุฌุนุงุช)
5. ุฅูุดุงุก ููุงุชูุฑ ูุจูุนุงุช ููุฒุน
6. ุงูุชุญูู ูู ุงููููุงุช
7. ุฅููุงู ุงูุฑุญูุฉ
8. ุงูุชุญูู ูู ุงููุชุงุฆุฌ

### ุงุฎุชุจุงุฑ ุงูุญุงูุงุช ุงูุงุณุชุซูุงุฆูุฉ:
- ูุญุงููุฉ ุฅูุดุงุก ุฑุญูุฉ ุจููุธู ุบูุฑ ููุฌูุฏ
- ูุญุงููุฉ ุฅูุดุงุก ุฑุญูุฉ ุจูููุฉ ุบูุฑ ูุชุงุญุฉ
- ูุญุงููุฉ ุชุฑุญูู ุฑุญูุฉ ููุณุช ูู ุญุงูุฉ Draft
- ูุญุงููุฉ ุงุณุชูุงู ุงูุจุถุงุนุฉ ูุฑุญูุฉ ูู ุญุงูุฉ Draft
- ูุญุงููุฉ ุฅูุดุงุก ูุงุชูุฑุฉ ููุฒุน ูุฑุญูุฉ ูู ุญุงูุฉ Posted

## ๐ ุงูููุฒุงุช ุงููุณุชูุจููุฉ

1. **ุชุทุจูู GPS** ูุชุชุจุน ุงูุฑุญูุงุช ูู ุงูููุช ุงููุนูู
2. **ูุธุงู ุฌุฏููุฉ ุฐูู** ูุชุญุณูู ุงููุณุงุฑุงุช
3. **ุชุทุจูู ููุจุงูู** ููููุฒุนูู
4. **ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ** ููููุธููู
5. **ุชุญููู ูุชูุฏู** ููุจูุงูุงุช
6. **ุฅุฏุงุฑุฉ ุงููููุฏ** ููุตุฑููุงุช ุงูุณูุงุฑุงุช
7. **ุชุชุจุน ุงูุฃุฏุงุก** ููููุฒุนูู
8. **ุชูุงุฑูุฑ ูุงููุฉ** ููุตูุฉ ููุชูุฒูุน

## ๐ ููุงุญุธุงุช ูููุฉ

### ุงูุฃูุงู:
- ุฌููุน ุงูุนูููุงุช ุชุชุทูุจ ุชูููุถ (Authorization)
- ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูู ูู ูุฑุญูุฉ
- ุงูุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช ูู ุญุงูุฉ ุงูุฎุทุฃ

### ุงูุฃุฏุงุก:
- ุงุณุชุฎุฏุงู Pagination ููููุงุฆู ุงููุจูุฑุฉ
- ุชุญุณูู ุงูุงุณุชุนูุงูุงุช ุจุงุณุชุฎุฏุงู Include
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ููุงุณุจ

### ุงูุตูุงูุฉ:
- ููุฏ ููุธู ูููุณู ุญุณุจ ุงูุทุจูุงุช
- ุงุณุชุฎุฏุงู Design Patterns (Repository, CQRS)
- ุชูุซูู ุดุงูู ูููุงุฌูุงุช

## ๐ฏ ุงูุฎูุงุตุฉ

ูุธุงู ุฑุญูุฉ ุงูุชูุฒูุน ูู MarketZone ูู ูุธุงู ูุชูุงูู ูุดุงูู ูุฅุฏุงุฑุฉ ุนูููุฉ ุงูุชูุฒูุน. ูุชููุฒ ุจุงููุฑููุฉ ูุงูุฃูุงู ูุงููุงุจููุฉ ููุชูุณุน. ุงููุธุงู ูุฏุนู ุฌููุน ูุฑุงุญู ุงูุนูููุฉ ูู ุงูุฅูุดุงุก ุญุชู ุงูุฅููุงู ูุน ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุฅุฏุงุฑุฉ ุงููุฎุฒูู ุจุดูู ุชููุงุฆู.

---

*ุชู ุฅุนุฏุงุฏ ูุฐุง ุงูุชูุฑูุฑ ุจูุงุกู ุนูู ุชุญููู ุดุงูู ูุฌููุน ูููุงุช ุงููุธุงู ุงููุชุนููุฉ ุจุฑุญูุฉ ุงูุชูุฒูุน*
